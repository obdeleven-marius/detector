<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>App Redirection</title>
</head>
<body>

  <!-- iframe used for attempting to load a custom protocol -->
  <iframe style="display:none" height="0" width="0" id="loader"></iframe>

  <!-- Button to trigger the redirection -->
  <button onclick="redirectToApp()">Redirect to App</button>

  <script>
    function redirectToApp() {
      // For desktop browser, remember to pass though any metadata on the link for deep linking
      var fallbackLink = 'http://obdeleven.com'+window.location.search+window.location.hash;

      // Simple device detection
      var isiOS = navigator.userAgent.match('iPad') || navigator.userAgent.match('iPhone') || navigator.userAgent.match('iPod'),
          isAndroid = navigator.userAgent.match('Android');

      // Mobile
      if (isiOS || isAndroid) {
        // Load our custom protocol in the iframe, for Chrome and Opera this burys the error dialog (which is actually HTML)
        // for iOS we will get a popup error if this protocol is not supported, but it won't block javascript
        document.getElementById('loader').src = 'obdeleven://'+window.location.search+window.location.hash;

        // Modify fallbackLink based on the device
        //fallbackLink = isAndroid ? 'https://play.google.com/store/apps/details?id=com.mycompany.myapp' :
        //                           'itms-apps://itunes.apple.com/app/my-app/idxxxxxxxx?mt=8' ;
      }

      // Now we just wait for everything to execute, if the user is redirected to your custom app
      // the timeout below will never fire, if a custom app is not present (or the user is on the Desktop)
      // we will replace the current URL with the fallbackLink (store URL or desktop URL as appropriate)
      window.setTimeout(function (){ window.location.replace(fallbackLink); }, 1);
    }
  </script>
</body>
</html>
